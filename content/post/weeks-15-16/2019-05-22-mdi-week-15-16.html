---
title: 'MDI: Week 15 & 16'
author: Stephen Coleman
date: '2019-05-22'
slug: mdi-week-15-16
categories: []
tags: []
image:
  caption: ''
  focal_point: ''
bibliography: Weeks_15_16.bib
---



<p>This project is immensely enabled by the R programming language <span class="citation">(R Core Team 2019)</span>. Most data analysis and processing was carried out within R using a number of packages. The packages from <span class="citation">Wickham et al. (2019)</span> (data processing and wrangling), <span class="citation">Bache and Wickham (2014)</span> (data processing), <span class="citation">Wickham (2016)</span> (visualisation), <span class="citation">Müller and Wickham (2019)</span> (data storage) and <span class="citation">Dowle and Srinivasan (2019)</span> (reading, writing and processing data) deserve special mention as they tend to be imported in multiple of my scripts for multiple purposes.</p>
<p>I have fallen behind in tracking my progress, so starting afresh.</p>
<div id="mdi-tissue-specific-gene-sets" class="section level1">
<h1>MDI: Tissue specific gene sets</h1>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>We want to apply multiple dataset integration (MDI) <span class="citation">(P. Kirk et al. 2012)</span>, a Bayesian unsupervised clustering method, to gene expression data from various tissue / cell types to create tissue specific gene sets. We are using the data from the Correlated Expression and Disease Association Research (CEDAR) cohort <span class="citation">(The International IBD Genetics Consortium et al. 2018)</span>.</p>
<p>We have 9 .csv files, one for each tissue / cell type present of normalised gene expression data for 323 individuals. These are healthy individuals of European descent; the cohort consists of 182 women and 141 men with an average age of 56 years (but ranging from 19 to 86). None of the individuals are suffering from any autoimmune or inflammatory disease and were not taking corticosteroids or non-steroid anti-inflammatory drugs (with the exception of aspirin).</p>
<p>With regards to tissue types, samples from six circulating immune cells types:</p>
<ol style="list-style-type: decimal">
<li>CD4+ T lymphocytes (CD4);</li>
<li>CD8+ T lymphocytes (CD8);</li>
<li>CD14+ monocytes (CD14);</li>
<li>CD15+ granulocytes (CD15);</li>
<li>CD19+ B lymphocytes (CD19); and</li>
<li>platelets (PLA).</li>
</ol>
<p>Data from intestinal biopsies are also present, with sample taken from three distinct locations:</p>
<ol style="list-style-type: decimal">
<li>the illeum (IL);</li>
<li>the rectum (RE); and</li>
<li>the colon (TR).</li>
</ol>
<p>Not every individual is present in every dataset. However, as we are clustering genes this should not present a problem</p>
<p>Whole genome expression data were generated using HT-12 Expression Beadchips following the instructions of the manufacturer (Illumina). 29,464 autosomal probes (corresponding to 19,731 genes) were included across the datasets, but further thinning under various criteria reduced this further in each dataset. The fluorescence intensities were <span class="math inline">\(\log_2\)</span> transformed and Robust Spline Normalized with Lumi38.</p>
<p>It should be noted that some datasets are less information rich than others (for instance the platelets dataset has only around 8 thousand probes present).</p>
</div>
<div id="pipeline" class="section level2">
<h2>Pipeline</h2>
<p>Overview of steps currently implemented:</p>
<ol style="list-style-type: decimal">
<li><a href="https://github.com/stcolema/ra_chris_wallace/blob/master/Data_prep/download_data.R">Download</a> the <a href="http://139.165.108.18/srv/genmol/permanent/1be6993fe41c12a051c9244d67c91da2be49e5dd26a6cd79f442bc006971e2ef/CEDAR_GE/GE_Corr/crohn-index.html">data</a>;</li>
<li><a href="https://github.com/stcolema/ra_chris_wallace/blob/master/Data_prep/gene_subsetter_original_data.R">Subset the data</a> using the gene subsets (divided into big, med, small);</li>
<li><a href="https://github.com/stcolema/ra_chris_wallace/blob/master/Data_prep/matrix_transposer.R">Transpose the data and remove NAs</a>;</li>
<li>Inspect the data by <a href="https://github.com/stcolema/ra_chris_wallace/blob/master/Data_prep/pca_outlier_finding_gene_subsets.R">PCA</a> and remove outlier individuals for each dataset in each gene set;</li>
<li>To apply MDI we require that each dataset have the same row names in the same order, so we re-arrange our datasets to have common order of probes and include rows of 0’s for probes entirely missing using <a href="https://github.com/stcolema/ra_chris_wallace/blob/master/Data_prep/finad_all_probe_ids.R">this script</a>;</li>
<li>Apply MDI (either as implemented by <span class="citation">Mason et al. (2016)</span> or the original MATLAB code); and</li>
<li><a href="https://github.com/stcolema/ra_chris_wallace/blob/master/Analysis/analysis_script.R">Inspect the output</a> under several areas:
<ol style="list-style-type: decimal">
<li>Convergence of the <span class="math inline">\(\phi\)</span> parameter between datasets over iterations;</li>
<li>The disctribution of the <span class="math inline">\(\phi\)</span> parameter samples over MCMC iterations;</li>
<li>The posterior similarity matrix (PSM) for the clustering over MCMC iterations;</li>
<li>The adjusted rand index comparing the clustering in each iteration to the predicted clustering using <code>Simtocl()</code> from the <code>mclust</code> <span class="citation">(Fritsch 2012)</span> package in R;</li>
<li>Inspect the clustering with the expression data using the <code>pheatmap</code> function <span class="citation">(Kolde 2019)</span>.</li>
</ol></li>
</ol>
</div>
<div id="transpose-the-data-and-remove-nas" class="section level2">
<h2>Transpose the data and remove NAs</h2>
<p>The data comes in the form [people <span class="math inline">\(\times\)</span> probes]. As we are interested in clustering genes (represented by the probes), we wish to transpose the data to fit the format required by MDI. Furthermore, MDI cannot handle NAs. We therefore wish to either remove NAs or impute a value in. As the missingness is not at random as if the expression levels are too low for a given reading it is left empty. This means we will fill NAs with the minimum expression value in the given row. However, if a probe is missing across a significant number of people (defined here as being above some fraction of the people present), we remove it from the dataset. We use an initial value of 0.1 for this threshold.</p>
</div>
<div id="pca-and-visualisation" class="section level2">
<h2>PCA and visualisation</h2>
<p>We inspect the data to get some insight into underlying structure using PCA 9as simplemented by <span class="citation">Kassambara and Mundt (2017)</span>). This step can also be used to identify outliers that might be removed.</p>
</div>
<div id="re-arrange-the-order" class="section level2">
<h2>Re-arrange the order</h2>
<p>We want the same rownames and the order of rownames (here probe IDs) in each dataset. Some probes are not present in every dataset and these are added with an expression level of 0 (well below the minimum value representing observed data). We then put each dataset in the same order of probes.</p>
</div>
<div id="mdi" class="section level2">
<h2>MDI</h2>
<p>We have a choice of two flavours of MDI.</p>
<ol style="list-style-type: decimal">
<li>The C++ implementation from <span class="citation">Mason et al. (2016)</span>; or</li>
<li>The MATLAB implementation from <span class="citation">P. Kirk et al. (2012)</span> and used for glioblastoma subtyping by <span class="citation">Savage et al. (2013)</span>.</li>
</ol>
<p>The C++ version is faster and can handle the full 9 datasets. However, the MATLAB code includes a split-merge step <span class="citation">(Dahl 2005)</span> that is designed to help the program explore the full posterior space.</p>
<div id="c-implementation-and-many-seeds" class="section level3">
<h3>C++ implementation and many seeds</h3>
<p>We have observed that the C++ version is given to becoming stuck in a single clustering and not exploring the space much at all.</p>
<div class="figure">
<img src="/post/2019-03-04-mdi-week-4_files/iteration_heatplot_TR.png" alt="Clustering across iterations for each probe in the TR dataset. Notice how quickly it becomes stuck." />
<p class="caption">Clustering across iterations for each probe in the TR dataset. Notice how quickly it becomes stuck.</p>
</div>
<p>Ideally the MATLAB code should overcome this issue but we also consider model averaging. The idea is that we take <span class="math inline">\(n\)</span> start points for the C++ code, thin aggressively (on the basis that as the code becomes stuck quickly, the clustering in the final iteration is representative of the entire run) and treat this recorded clustering as a single draw from the posterior space and use the <span class="math inline">\(n\)</span> draws to decribe the clustering. To do this we use <span class="math inline">\(n\)</span> different random seeds and run for a small number of iterations (initially 500) and keep only the 500th iteration in each run. We then use <a href="https://github.com/stcolema/ra_chris_wallace/blob/master/Data_prep/big_csv.py">a python script</a> to collapse these values into one .csv file of the same format as if we had run <span class="math inline">\(n\)</span> iterations using the vanilla C++ implementation.</p>
</div>
<div id="matlab-implementation" class="section level3">
<h3>MATLAB implementation</h3>
<p>The MATLAB code uses more memory and thus is limited to at most 7 datasets.</p>
</div>
</div>
<div id="bibliography" class="section level2 unnumbered">
<h2>Bibliography</h2>
<div id="refs" class="references">
<div id="ref-bache2014magrittr">
<p>Bache, Stefan Milton, and Hadley Wickham. 2014. <em>Magrittr: A Forward-Pipe Operator for R</em>. <a href="https://CRAN.R-project.org/package=magrittr" class="uri">https://CRAN.R-project.org/package=magrittr</a>.</p>
</div>
<div id="ref-dahl_sequentially-allocated_2005">
<p>Dahl, David B. 2005. “Sequentially-Allocated Merge-Split Sampler for Conjugate and Nonconjugate Dirichlet Process Mixture Models,” 27.</p>
</div>
<div id="ref-dowle2019data">
<p>Dowle, Matt, and Arun Srinivasan. 2019. <em>Data.table: Extension of ‘Data.frame‘</em>. <a href="https://CRAN.R-project.org/package=data.table" class="uri">https://CRAN.R-project.org/package=data.table</a>.</p>
</div>
<div id="ref-fritsch2012mcclust">
<p>Fritsch, Arno. 2012. <em>Mcclust: Process an Mcmc Sample of Clusterings</em>. <a href="https://CRAN.R-project.org/package=mcclust" class="uri">https://CRAN.R-project.org/package=mcclust</a>.</p>
</div>
<div id="ref-kassambara2017factoextra">
<p>Kassambara, Alboukadel, and Fabian Mundt. 2017. <em>Factoextra: Extract and Visualize the Results of Multivariate Data Analyses</em>. <a href="http://www.sthda.com/english/rpkgs/factoextra" class="uri">http://www.sthda.com/english/rpkgs/factoextra</a>.</p>
</div>
<div id="ref-kirk_bayesian_2012">
<p>Kirk, Paul, Jim E. Griffin, Richard S. Savage, Zoubin Ghahramani, and David L. Wild. 2012. “Bayesian Correlated Clustering to Integrate Multiple Datasets.” <em>Bioinformatics</em> 28 (24): 3290–7. doi:<a href="https://doi.org/10.1093/bioinformatics/bts595">10.1093/bioinformatics/bts595</a>.</p>
</div>
<div id="ref-kolde2019pheatmap">
<p>Kolde, Raivo. 2019. <em>Pheatmap: Pretty Heatmaps</em>. <a href="https://CRAN.R-project.org/package=pheatmap" class="uri">https://CRAN.R-project.org/package=pheatmap</a>.</p>
</div>
<div id="ref-mason2016mdi">
<p>Mason, Samuel A, Faiz Sayyid, Paul DW Kirk, Colin Starr, and David L Wild. 2016. “MDI-Gpu: Accelerating Integrative Modelling for Genomic-Scale Data Using Gp-Gpu Computing.” <em>Statistical Applications in Genetics and Molecular Biology</em> 15 (1). De Gruyter: 83–86.</p>
</div>
<div id="ref-muller2019tibble">
<p>Müller, Kirill, and Hadley Wickham. 2019. <em>Tibble: Simple Data Frames</em>. <a href="https://CRAN.R-project.org/package=tibble" class="uri">https://CRAN.R-project.org/package=tibble</a>.</p>
</div>
<div id="ref-R2019">
<p>R Core Team. 2019. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-savage_identifying_2013">
<p>Savage, Richard S., Zoubin Ghahramani, Jim E. Griffin, Paul Kirk, and David L. Wild. 2013. “Identifying Cancer Subtypes in Glioblastoma by Combining Genomic, Transcriptomic and Epigenomic Data.” <em>arXiv:1304.3577 [Q-Bio, Stat]</em>, April. <a href="http://arxiv.org/abs/1304.3577" class="uri">http://arxiv.org/abs/1304.3577</a>.</p>
</div>
<div id="ref-the_international_ibd_genetics_consortium_ibd_2018">
<p>The International IBD Genetics Consortium, Yukihide Momozawa, Julia Dmitrieva, Emilie Théâtre, Valérie Deffontaine, Souad Rahmouni, Benoît Charloteaux, et al. 2018. “IBD Risk Loci Are Enriched in Multigenic Regulatory Modules Encompassing Putative Causative Genes.” <em>Nature Communications</em> 9 (1): 2427. doi:<a href="https://doi.org/10.1038/s41467-018-04365-8">10.1038/s41467-018-04365-8</a>.</p>
</div>
<div id="ref-wickham2016ggplot2">
<p>Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org" class="uri">https://ggplot2.tidyverse.org</a>.</p>
</div>
<div id="ref-wickham2019dplyr">
<p>Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2019. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="uri">https://CRAN.R-project.org/package=dplyr</a>.</p>
</div>
</div>
</div>
</div>
